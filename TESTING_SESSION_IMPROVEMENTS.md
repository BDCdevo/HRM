# ๐งช ุฏููู ุงุฎุชุจุงุฑ ุชุญุณููุงุช ุญูุธ ุงูุฌูุณุฉ

**ุงูุชุงุฑูุฎ**: 2025-11-19

---

## ๐ฏ ุงูุณููุงุฑูููุงุช ุงููุทููุจ ุงุฎุชุจุงุฑูุง

### โ ุงูุณููุงุฑูู 1: ุชุณุฌูู ุฏุฎูู ุฌุฏูุฏ

**ุงูุฎุทูุงุช**:
1. ุงูุชุญ ุงูุชุทุจูู
2. ุณุฌู ุฏุฎูู ุจู `Ahmed@bdcbiz.com` / `password`
3. ุงูุชุธุฑ ุญุชู ุชุธูุฑ ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
```
Console Logs:
๐ Attempting employee login for: Ahmed@bdcbiz.com
โ Login successful for: Ahmed@bdcbiz.com
๐ Token and user data saved successfully
๐ Session started: [session_id]
```

**ูุง ูุชู ุญูุธู**:
- โ `auth_token`
- โ `user_id`
- โ `user_email`
- โ `user_first_name`
- โ `user_last_name`
- โ `user_company_id`
- โ `current_session_id`

---

### โ ุงูุณููุงุฑูู 2: ุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู (Cache Hit)

**ุงูุฎุทูุงุช**:
1. **ุจุนุฏ ุงูุณููุงุฑูู 1**: ุงุบูู ุงูุชุทุจูู ุชูุงูุงู
2. ุงูุชุญ ุงูุชุทุจูู ูุฑุฉ ุฃุฎุฑู
3. ุฑุงูุจ ุณุฑุนุฉ ุงููุชุญ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
```
Console Logs:
๐ Checking auth status...
โ User has token
๐ฆ Loaded cached user data: Ahmed@bdcbiz.com
[UI ูุธูุฑ ููุฑุงู ููุง - < 100ms]
โ Profile verified and refreshed: Ahmed@bdcbiz.com
```

**ููุงุญุธุงุช**:
- โก **ุงูุณุฑุนุฉ**: ูุฌุจ ุฃู ุชุฑู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ ููุฑุงู (< 100ms)
- โ UI ูุธูุฑ ูุจู ุงูุชูุงุก API call
- ๐ ูุชู ุงูุชุญุฏูุซ ูู ุงูุฎูููุฉ

---

### โ ุงูุณููุงุฑูู 3: ุฅุนุงุฏุฉ ูุชุญ ุจุฏูู ุงูุชุฑูุช (Offline Mode)

**ุงูุฎุทูุงุช**:
1. **ุจุนุฏ ุงูุณููุงุฑูู 1**: ุงุบูู ุงูุชุทุจูู
2. **ุงูุตู ุงูุงูุชุฑูุช** (WiFi + Mobile Data)
3. ุงูุชุญ ุงูุชุทุจูู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
```
Console Logs:
๐ Checking auth status...
โ User has token
๐ฆ Loaded cached user data: Ahmed@bdcbiz.com
[UI ูุธูุฑ ููุฑุงู]
โ๏ธ Failed to refresh profile (using cached data): [network error]
```

**ููุงุญุธุงุช**:
- โ ุงูุชุทุจูู ูุนูู ุจุฏูู ุงูุชุฑูุช
- โ ุชุธูุฑ ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ ุจุดูู ุทุจูุนู
- โ๏ธ ุนูุฏ ูุญุงููุฉ ุนูู ุฃู action: "ูุง ููุฌุฏ ุงุชุตุงู ุจุงูุฅูุชุฑูุช"
- โ ุงููุณุชุฎุฏู ูุจูู ูุณุฌู ุฏุฎูู

---

### โ ุงูุณููุงุฑูู 4: ุชุณุฌูู ุฎุฑูุฌ

**ุงูุฎุทูุงุช**:
1. ูู More Screen โ ุงุถุบุท ุชุณุฌูู ุฎุฑูุฌ
2. ุฃูุฏ ุงูุนูููุฉ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
```
Console Logs:
๐ Attempting logout
๐ Session ended successfully
โ Logout successful
๐ All auth data cleared
๐๏ธ Session data cleared
```

**ูุง ูุชู ุญุฐูู**:
- โ ุฌููุน ุจูุงูุงุช `auth_*`
- โ ุฌููุน ุจูุงูุงุช `user_*`
- โ `current_session_id`
- โ `current_session_token`

**ุจุนุฏ ุงูุญุฐู**:
- โ ูุชู ุงูุชูุฌูู ูุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู
- โ ุนูุฏ ุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู โ ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู

---

### โ ุงูุณููุงุฑูู 5: Token ููุชูู (Expired)

**ุงูุฎุทูุงุช** (ูุญุชุงุฌ Backend):
1. ุณุฌู ุฏุฎูู
2. ูู Backend: ุงุญุฐู ุงูู Token ุฃู ูู ุจุชุบููุฑ session status ุฅูู 'expired'
3. ุงุบูู ุงูุชุทุจูู ูุงูุชุญู ูุฑุฉ ุฃุฎุฑู

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
```
Console Logs:
๐ Checking auth status...
โ User has token
๐ฆ Loaded cached user data: Ahmed@bdcbiz.com
[UI ูุธูุฑ ูุคูุชุงู]
โ Failed to fetch profile (token may be expired): [401 error]
๐ All auth data cleared
๐๏ธ Session data cleared
```

**ููุงุญุธุงุช**:
- โ ูุชู ุงูุชุดุงู Token ุงูููุชูู ุชููุงุฆูุงู
- โ Auto-logout
- โ ุฅุนุงุฏุฉ ุงูุชูุฌูู ูุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู

---

### โ ุงูุณููุงุฑูู 6: ุชุณุฌูู ุฏุฎูู ูู ุฌูุงุฒูู

**ุงูุฎุทูุงุช** (ูุญุชุงุฌ Backend Session Management):
1. ุณุฌู ุฏุฎูู ูู ุงูุฌูุงุฒ A
2. ุณุฌู ุฏุฎูู ูู ุงูุฌูุงุฒ B ุจููุณ ุงูุญุณุงุจ
3. ุนูู ุงูุฌูุงุฒ A: ุงุบูู ุงูุชุทุจูู ูุงูุชุญู

**ุงูุณููู ุงููุชููุน (ุญุณุจ ุณูุงุณุฉ Backend)**:
- **Option A**: ูุณูุญ ุจุฌูุณุชูู (ููุงููุง ูุนูู)
- **Option B**: ุงูุฌูุณุฉ ุงูุฃุญุฏุซ ุชูุบู ุงููุฏููุฉ (ุงูุฌูุงุฒ A ููุทูุจ ููู ุชุณุฌูู ุฏุฎูู)

---

## ๐ ููููุฉ ููุงุณ ุงูุฃุฏุงุก

### ููุงุณ ุณุฑุนุฉ ุจุฏุก ุงูุชุทุจูู:

```dart
// ูู main.dart - checkAuthStatus()
print('โฑ๏ธ Start: ${DateTime.now()}');

final cachedUser = await _authRepo.getStoredUserData();

if (cachedUser != null) {
  emit(AuthAuthenticated(cachedUser));
  print('โฑ๏ธ UI Ready: ${DateTime.now()}'); // ูุฌุจ ุฃู ุชููู < 100ms
}
```

**ุงูููุงุณุงุช ุงููุณุชูุฏูุฉ**:
- โ **Cache Hit**: 50-100ms
- โ **Cache Miss (first time)**: 500-1000ms
- โ **Offline**: 50-100ms (ููุณ Cache Hit)

---

## ๐ Troubleshooting

### ุงููุดููุฉ: Cached Data ูุง ุชุธูุฑ

**ุงูุญู**:
1. ุชุญูู ูู Console Logs - ูู `๐ฆ Loaded cached user data` ููุฌูุฏุ
2. ุฅุฐุง ูู ููู ููุฌูุฏุงู:
   ```dart
   // ุชุญูู ูู ุฃู saveUserData() ููุณุชุฏุนู ุนูุฏ Login
   if (loginResponse.data.hasToken) {
     await saveUserData(loginResponse.data); // โญ ูู ููุฌูุฏุ
   }
   ```

### ุงููุดููุฉ: UI ุจุทูุก ุฑุบู Cache

**ุงูุญู**:
```dart
// ุชุฃูุฏ ูู ุฃู emit() ูุญุฏุซ ููุฑุงู
if (cachedUser != null) {
  emit(AuthAuthenticated(cachedUser)); // โญ ูุฌุจ ุฃู ูููู ูุจู API call

  // ูููุณ ุจุนุฏ API call
  try {
    final user = await _authRepo.getProfile();
    // ...
  }
}
```

### ุงููุดููุฉ: ุจูุงูุงุช ูุฏููุฉ ูุง ุชุชุญุฏุซ

**ุงูุญู**:
- ุงูุจูุงูุงุช **ูุฌุจ** ุฃู ุชุชุญุฏุซ ูู ุงูุฎูููุฉ
- ุชุญูู ูู Console Logs: `โ Profile verified and refreshed`
- ุฅุฐุง ูู ุชุชุญุฏุซุ ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช

---

## ๐ Checklist ููุงุฎุชุจุงุฑ

### ูุจู ุงูู Release:

- [ ] โ ุงูุณููุงุฑูู 1: ุชุณุฌูู ุฏุฎูู ุฌุฏูุฏ
- [ ] โ ุงูุณููุงุฑูู 2: ุฅุนุงุฏุฉ ูุชุญ (ูุน ูุช)
- [ ] โ ุงูุณููุงุฑูู 3: ุฅุนุงุฏุฉ ูุชุญ (ุจุฏูู ูุช)
- [ ] โ ุงูุณููุงุฑูู 4: ุชุณุฌูู ุฎุฑูุฌ
- [ ] โ ุงูุณููุงุฑูู 5: Token ููุชูู
- [ ] โ ููุงุณ ุงูุณุฑุนุฉ: < 100ms ููู Cache Hit
- [ ] โ ูุญุต Memory Leaks
- [ ] โ ุงุฎุชุจุงุฑ ุนูู Android
- [ ] โ ุงุฎุชุจุงุฑ ุนูู iOS (ุฅุฐุง ูุชููุฑ)
- [ ] โ ุงุฎุชุจุงุฑ ุนูู ุฃุฌูุฒุฉ ูุฎุชููุฉ

---

## ๐ฏ ุงููุนุงููุฑ ุงููุทููุจุฉ

| ุงููุนูุงุฑ | ุงููููุฉ ุงููุณุชูุฏูุฉ | ุงูุญุงูุฉ |
|---------|------------------|--------|
| **ุณุฑุนุฉ ุจุฏุก ุงูุชุทุจูู (Cache)** | < 100ms | โณ |
| **ุณุฑุนุฉ ุจุฏุก ุงูุชุทุจูู (No Cache)** | < 1000ms | โณ |
| **ุฏุนู Offline Mode** | โ ูุนูู | โณ |
| **Auto-logout ุนูุฏ Expiry** | โ ูุนูู | โณ |
| **Session Tracking** | โ ูุนูู | โณ |
| **Data Persistence** | โ ูุญูุธ | โณ |

---

## ๐ ูู ุญุงูุฉ ุงููุดุงูู

1. **ุฑุงุฌุน Console Logs** - ุชุญุชูู ุนูู ูุนูููุงุช ุชูุตูููุฉ
2. **ุฑุงุฌุน `SESSION_PERSISTENCE_IMPROVEMENTS.md`** - ุงููุซุงุฆู ุงููุงููุฉ
3. **ุชุญูู ูู Secure Storage**:
   ```dart
   final storage = FlutterSecureStorage();
   final token = await storage.read(key: 'auth_token');
   final userId = await storage.read(key: 'user_id');
   print('Token: $token');
   print('User ID: $userId');
   ```

---

**ุขุฎุฑ ุชุญุฏูุซ**: 2025-11-19
**ุงูุญุงูุฉ**: โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ
