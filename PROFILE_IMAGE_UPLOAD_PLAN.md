# ğŸ“¸ Profile Image Upload - Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°

## ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

### Ø§Ù„Ù‡Ø¯Ù
Ø§Ù„Ø³Ù…Ø§Ø­ Ù„ÙƒÙ„ Ù…ÙˆØ¸Ù Ø¨Ø±ÙØ¹ ÙˆØªØ­Ø¯ÙŠØ« ØµÙˆØ±ØªÙ‡ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ.

### Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
- âœ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶ (Gallery)
- âœ… Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Camera)
- âœ… Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹
- âœ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù€ default
- âœ… Crop & Resize ØªÙ„Ù‚Ø§Ø¦ÙŠ
- âœ… ØªØ­Ø³ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© (Compression)
- âœ… Ø¯Ø¹Ù… Dark Mode

### Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©
- **Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø©**: Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB
- **Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©**: JPG, PNG, JPEG
- **Ø§Ù„ØªØ®Ø²ÙŠÙ†**: Laravel Storage (public disk)
- **Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©**: 512x512 px
- **Compression**: 80% quality

---

## ğŸ—“ï¸ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ

| Ø§Ù„Ù…Ø±Ø­Ù„Ø© | Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ | Ø§Ù„ÙˆØµÙ |
|--------|--------------|-------|
| Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Backend (Database) | Ù†ØµÙ ÙŠÙˆÙ… | Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ Ù„Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ |
| Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Backend (API) | ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ | ØªØ·ÙˆÙŠØ± endpoints Ù„Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ø­Ø°Ù |
| Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Flutter (Models) | Ù†ØµÙ ÙŠÙˆÙ… | ØªØ­Ø¯ÙŠØ« UserModel |
| Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Flutter (Repository) | Ù†ØµÙ ÙŠÙˆÙ… | Ø¥Ù†Ø´Ø§Ø¡ ProfileImageRepository |
| Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Flutter (State Management) | Ù†ØµÙ ÙŠÙˆÙ… | ØªØ­Ø¯ÙŠØ« ProfileCubit |
| Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Flutter (UI) | ÙŠÙˆÙ…ÙŠÙ† | Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ |
| Ø§Ù„Ù…Ø±Ø­Ù„Ø© 7: Testing | ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ | Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ |
| Ø§Ù„Ù…Ø±Ø­Ù„Ø© 8: Deployment | Ù†ØµÙ ÙŠÙˆÙ… | Ù†Ø´Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± |
| **Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ** | **6 Ø£ÙŠØ§Ù…** | |

---

## ğŸ”§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Backend - Database Schema

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: Ù†ØµÙ ÙŠÙˆÙ…

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 1.1 Ø¥Ù†Ø´Ø§Ø¡ Migration

**Ø§Ù„Ù…Ø³Ø§Ø±**: `D:\php_project\filament-hrm\database\migrations\`

```bash
cd D:\php_project\filament-hrm
php artisan make:migration add_profile_image_to_employees_table
```

**Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù€ Migration**:

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('employees', function (Blueprint $table) {
            // Add profile image columns
            $table->string('profile_image_path')->nullable()->after('email');
            $table->timestamp('profile_image_uploaded_at')->nullable()->after('profile_image_path');

            // Add index for faster queries
            $table->index('profile_image_path');
        });
    }

    public function down(): void
    {
        Schema::table('employees', function (Blueprint $table) {
            $table->dropIndex(['profile_image_path']);
            $table->dropColumn(['profile_image_path', 'profile_image_uploaded_at']);
        });
    }
};
```

#### 1.2 ØªØ´ØºÙŠÙ„ Migration

```bash
# Ù…Ø­Ù„ÙŠ (Local)
cd D:\php_project\filament-hrm
php artisan migrate

# Ø¥Ù†ØªØ§Ø¬ (Production) - Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ
ssh -i ~/.ssh/id_ed25519 root@31.97.46.103
cd /var/www/erp1
php artisan migrate
```

#### 1.3 ØªØ­Ø¯ÙŠØ« Employee Model

**Ø§Ù„Ù…Ø³Ø§Ø±**: `D:\php_project\filament-hrm\app\Models\Employee.php`

```php
// Ø£Ø¶Ù Ù„Ù„Ù€ $fillable
protected $fillable = [
    // ... existing fields
    'profile_image_path',
    'profile_image_uploaded_at',
];

// Ø£Ø¶Ù Accessor Ù„Ù„Ù€ image URL
protected $appends = ['profile_image_url'];

public function getProfileImageUrlAttribute(): ?string
{
    if (!$this->profile_image_path) {
        return null;
    }

    // Return full URL
    return Storage::url($this->profile_image_path);
}

// Cast
protected $casts = [
    // ... existing casts
    'profile_image_uploaded_at' => 'datetime',
];

// Helper method to get image URL or default avatar
public function getAvatarUrlAttribute(): string
{
    return $this->profile_image_url ?? asset('images/default-avatar.png');
}
```

---

## ğŸ”§ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Backend - API Development

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 2.1 Ø¥Ù†Ø´Ø§Ø¡ Controller

```bash
cd D:\php_project\filament-hrm
php artisan make:controller Api/V1/ProfileImageController
```

**Ø§Ù„Ù…Ø³Ø§Ø±**: `D:\php_project\filament-hrm\app\Http\Controllers\Api\V1\ProfileImageController.php`

**Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù€ Controller**:

```php
<?php

namespace App\Http\Controllers\Api\V1;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Storage;
use Illuminate\Support\Facades\Validator;
use Intervention\Image\Facades\Image;

/**
 * Profile Image Controller
 *
 * Handles profile image upload, update, and deletion
 */
class ProfileImageController extends Controller
{
    /**
     * Upload or update profile image
     */
    public function upload(Request $request)
    {
        // Validate request
        $validator = Validator::make($request->all(), [
            'image' => 'required|image|mimes:jpeg,jpg,png|max:5120', // Max 5MB
        ]);

        if ($validator->fails()) {
            return response()->json([
                'success' => false,
                'message' => 'ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©',
                'errors' => $validator->errors(),
            ], 422);
        }

        try {
            $employee = $request->user();
            $file = $request->file('image');

            // Delete old image if exists
            if ($employee->profile_image_path) {
                Storage::disk('public')->delete($employee->profile_image_path);
            }

            // Process image with Intervention Image
            $image = Image::make($file);

            // Resize to 512x512 (square)
            $image->fit(512, 512, function ($constraint) {
                $constraint->upsize();
            });

            // Optimize quality
            $image->encode('jpg', 80);

            // Generate unique filename
            $filename = 'profile_' . $employee->id . '_' . time() . '.jpg';
            $path = 'images/profiles/' . $filename;

            // Store processed image
            Storage::disk('public')->put($path, (string) $image);

            // Update employee record
            $employee->update([
                'profile_image_path' => $path,
                'profile_image_uploaded_at' => now(),
            ]);

            return response()->json([
                'success' => true,
                'message' => 'ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­',
                'data' => [
                    'image_url' => Storage::url($path),
                    'image_path' => $path,
                    'uploaded_at' => $employee->profile_image_uploaded_at,
                ],
            ], 200);

        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©',
                'error' => $e->getMessage(),
            ], 500);
        }
    }

    /**
     * Get current profile image
     */
    public function getImage(Request $request)
    {
        try {
            $employee = $request->user();

            if (!$employee->profile_image_path) {
                return response()->json([
                    'success' => true,
                    'message' => 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©',
                    'data' => [
                        'has_image' => false,
                        'image_url' => null,
                    ],
                ], 200);
            }

            // Check if file exists
            if (!Storage::disk('public')->exists($employee->profile_image_path)) {
                // File missing, clear database record
                $employee->update([
                    'profile_image_path' => null,
                    'profile_image_uploaded_at' => null,
                ]);

                return response()->json([
                    'success' => true,
                    'message' => 'Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©',
                    'data' => [
                        'has_image' => false,
                        'image_url' => null,
                    ],
                ], 200);
            }

            return response()->json([
                'success' => true,
                'message' => 'ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­',
                'data' => [
                    'has_image' => true,
                    'image_url' => Storage::url($employee->profile_image_path),
                    'uploaded_at' => $employee->profile_image_uploaded_at,
                ],
            ], 200);

        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø©',
                'error' => $e->getMessage(),
            ], 500);
        }
    }

    /**
     * Delete profile image
     */
    public function delete(Request $request)
    {
        try {
            $employee = $request->user();

            if (!$employee->profile_image_path) {
                return response()->json([
                    'success' => true,
                    'message' => 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ù„Ù„Ø­Ø°Ù',
                ], 200);
            }

            // Delete file from storage
            if (Storage::disk('public')->exists($employee->profile_image_path)) {
                Storage::disk('public')->delete($employee->profile_image_path);
            }

            // Update employee record
            $employee->update([
                'profile_image_path' => null,
                'profile_image_uploaded_at' => null,
            ]);

            return response()->json([
                'success' => true,
                'message' => 'ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­',
            ], 200);

        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù',
                'error' => $e->getMessage(),
            ], 500);
        }
    }
}
```

#### 2.2 Ø¥Ø¶Ø§ÙØ© Routes

**Ø§Ù„Ù…Ø³Ø§Ø±**: `D:\php_project\filament-hrm\routes\api.php`

```php
// Ø£Ø¶Ù Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù…ÙˆØ¹Ø© auth:sanctum
Route::middleware(['auth:sanctum'])->prefix('v1')->group(function () {
    // ... existing routes

    // Profile Image Routes
    Route::post('profile/image/upload', [ProfileImageController::class, 'upload']);
    Route::get('profile/image', [ProfileImageController::class, 'getImage']);
    Route::delete('profile/image', [ProfileImageController::class, 'delete']);
});
```

#### 2.3 ØªØ«Ø¨ÙŠØª Intervention Image (Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©)

```bash
cd D:\php_project\filament-hrm
composer require intervention/image
```

**ØªÙØ¹ÙŠÙ„ ÙÙŠ `config/app.php`**:

```php
'providers' => [
    // ...
    Intervention\Image\ImageServiceProvider::class,
],

'aliases' => [
    // ...
    'Image' => Intervention\Image\Facades\Image::class,
],
```

#### 2.4 Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù€ Backend

```bash
# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ø­Ù„ÙŠ
cd D:\php_project\filament-hrm
php artisan serve

# Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù€ routes
php artisan route:list --path=api/v1/profile

# Ù…Ø³Ø­ Ø§Ù„Ù€ cache
php artisan cache:clear
php artisan config:clear
php artisan route:clear
```

---

## ğŸ“± Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Flutter - Update UserModel

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: Ù†ØµÙ ÙŠÙˆÙ…

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 3.1 ØªØ­Ø¯ÙŠØ« UserModel

**Ø§Ù„Ù…Ø³Ø§Ø±**: `lib/features/auth/data/models/user_model.dart`

```dart
// Ø£Ø¶Ù Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
@JsonKey(name: 'profile_image_path')
final String? profileImagePath;

@JsonKey(name: 'profile_image_url')
final String? profileImageUrl;

@JsonKey(name: 'profile_image_uploaded_at')
final String? profileImageUploadedAt;

// ÙÙŠ Ø§Ù„Ù€ constructor
const UserModel({
  // ... existing parameters
  this.profileImagePath,
  this.profileImageUrl,
  this.profileImageUploadedAt,
});

// ÙÙŠ copyWith
UserModel copyWith({
  // ... existing parameters
  String? profileImagePath,
  String? profileImageUrl,
  String? profileImageUploadedAt,
}) {
  return UserModel(
    // ... existing fields
    profileImagePath: profileImagePath ?? this.profileImagePath,
    profileImageUrl: profileImageUrl ?? this.profileImageUrl,
    profileImageUploadedAt: profileImageUploadedAt ?? this.profileImageUploadedAt,
  );
}

// ÙÙŠ props
@override
List<Object?> get props => [
  // ... existing props
  profileImagePath,
  profileImageUrl,
  profileImageUploadedAt,
];

// Helper method to get avatar URL
String get avatarUrl {
  return profileImageUrl ?? 'https://ui-avatars.com/api/?name=$name&size=512';
}
```

**Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ Ø´ØºÙ„ build_runner**:
```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

---

## ğŸ“± Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Flutter - ProfileImageRepository

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: Ù†ØµÙ ÙŠÙˆÙ…

**Ø§Ù„Ù…Ø³Ø§Ø±**: `lib/features/profile/data/repo/profile_image_repository.dart`

**Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯**:

```dart
import 'package:dio/dio.dart';
import '../../../../core/networking/dio_client.dart';
import '../../../../core/config/api_config.dart';

/// Repository for handling profile image operations
class ProfileImageRepository {
  final _dioClient = DioClient.getInstance();

  /// Upload profile image
  Future<Map<String, dynamic>> uploadImage(String filePath) async {
    try {
      final formData = FormData.fromMap({
        'image': await MultipartFile.fromFile(
          filePath,
          filename: 'profile.jpg',
        ),
      });

      final response = await _dioClient.post(
        '${ApiConfig.baseUrl}/profile/image/upload',
        data: formData,
        options: Options(
          headers: {
            'Content-Type': 'multipart/form-data',
          },
        ),
      );

      if (response.statusCode == 200 && response.data['success'] == true) {
        return response.data['data'] as Map<String, dynamic>;
      }

      throw Exception(response.data['message'] ?? 'ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©');
    } on DioException catch (e) {
      if (e.response != null) {
        throw Exception(e.response!.data['message'] ?? 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©');
      }
      throw Exception('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
    } catch (e) {
      throw Exception('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: $e');
    }
  }

  /// Get current profile image
  Future<Map<String, dynamic>> getImage() async {
    try {
      final response = await _dioClient.get(
        '${ApiConfig.baseUrl}/profile/image',
      );

      if (response.statusCode == 200 && response.data['success'] == true) {
        return response.data['data'] as Map<String, dynamic>;
      }

      throw Exception(response.data['message'] ?? 'ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø©');
    } on DioException catch (e) {
      if (e.response != null) {
        throw Exception(e.response!.data['message'] ?? 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø©');
      }
      throw Exception('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
    } catch (e) {
      throw Exception('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: $e');
    }
  }

  /// Delete profile image
  Future<void> deleteImage() async {
    try {
      final response = await _dioClient.delete(
        '${ApiConfig.baseUrl}/profile/image',
      );

      if (response.statusCode == 200 && response.data['success'] == true) {
        return;
      }

      throw Exception(response.data['message'] ?? 'ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©');
    } on DioException catch (e) {
      if (e.response != null) {
        throw Exception(e.response!.data['message'] ?? 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù');
      }
      throw Exception('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
    } catch (e) {
      throw Exception('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: $e');
    }
  }
}
```

---

## ğŸ“± Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Flutter - Update ProfileCubit

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: Ù†ØµÙ ÙŠÙˆÙ…

**ØªØ­Ø¯ÙŠØ«**: `lib/features/profile/logic/cubit/profile_cubit.dart`

**Ø¥Ø¶Ø§ÙØ© methods Ø¬Ø¯ÙŠØ¯Ø©**:

```dart
import '../../../auth/logic/cubit/auth_cubit.dart';
import '../../data/repo/profile_image_repository.dart';

class ProfileCubit extends Cubit<ProfileState> {
  final ProfileRepository _repository;
  final ProfileImageRepository _imageRepository = ProfileImageRepository();
  final AuthCubit? _authCubit; // Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹

  ProfileCubit([this._authCubit]) : _repository = ProfileRepository(), super(ProfileInitial());

  // ... existing methods

  /// Upload profile image
  Future<void> uploadProfileImage(String filePath) async {
    emit(ProfileLoading());
    try {
      final data = await _imageRepository.uploadImage(filePath);

      // Update AuthCubit with new image URL
      if (_authCubit != null) {
        final currentState = _authCubit.state;
        if (currentState is AuthAuthenticated) {
          final updatedUser = currentState.user.copyWith(
            profileImageUrl: data['image_url'] as String?,
          );
          _authCubit.updateUser(updatedUser);
        }
      }

      emit(ProfileImageUploaded(
        imageUrl: data['image_url'] as String,
        message: 'ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­',
      ));
    } catch (e) {
      emit(ProfileError(e.toString().replaceAll('Exception: ', '')));
    }
  }

  /// Delete profile image
  Future<void> deleteProfileImage() async {
    emit(ProfileLoading());
    try {
      await _imageRepository.deleteImage();

      // Update AuthCubit to remove image
      if (_authCubit != null) {
        final currentState = _authCubit.state;
        if (currentState is AuthAuthenticated) {
          final updatedUser = currentState.user.copyWith(
            profileImageUrl: null,
          );
          _authCubit.updateUser(updatedUser);
        }
      }

      emit(ProfileImageDeleted('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­'));
    } catch (e) {
      emit(ProfileError(e.toString().replaceAll('Exception: ', '')));
    }
  }
}
```

**Ø¥Ø¶Ø§ÙØ© states Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ `profile_state.dart`**:

```dart
/// Profile image uploaded successfully
class ProfileImageUploaded extends ProfileState {
  final String imageUrl;
  final String message;

  const ProfileImageUploaded({
    required this.imageUrl,
    required this.message,
  });

  @override
  List<Object?> get props => [imageUrl, message];
}

/// Profile image deleted successfully
class ProfileImageDeleted extends ProfileState {
  final String message;

  const ProfileImageDeleted(this.message);

  @override
  List<Object?> get props => [message];
}
```

---

## ğŸ“± Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Flutter - UI Implementation

### Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ÙŠÙˆÙ…ÙŠÙ†

### 6.1 Ø¥Ù†Ø´Ø§Ø¡ Image Picker Widget

**Ø§Ù„Ù…Ø³Ø§Ø±**: `lib/core/widgets/profile_image_picker.dart`

**Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙ‚Ø©** â¬‡ï¸

### 6.2 ØªØ­Ø¯ÙŠØ« Profile Screen

**Ø§Ù„Ù…Ø³Ø§Ø±**: `lib/features/profile/ui/screens/profile_screen.dart`

**Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©**

---

## ğŸ¨ UI Components

### Avatar Widget with Edit Button

```dart
Stack(
  children: [
    // Avatar
    CircleAvatar(
      radius: 60,
      backgroundImage: user.profileImageUrl != null
        ? NetworkImage(user.profileImageUrl!)
        : null,
      child: user.profileImageUrl == null
        ? Text(user.name[0].toUpperCase())
        : null,
    ),

    // Edit button
    Positioned(
      right: 0,
      bottom: 0,
      child: IconButton(
        icon: Icon(Icons.camera_alt),
        onPressed: () => _showImagePickerOptions(),
      ),
    ),
  ],
)
```

---

## ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…ÙŠØ²Ø©

### Backend:
- âœ… Ø¹Ù…ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- âœ… 3 endpoints (upload, get, delete)
- âœ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± (resize, compress)
- âœ… ØªØ®Ø²ÙŠÙ† Ø¢Ù…Ù†

### Flutter:
- âœ… ØªØ­Ø¯ÙŠØ« UserModel
- âœ… ProfileImageRepository
- âœ… ØªØ­Ø¯ÙŠØ« ProfileCubit
- âœ… Image Picker (Camera + Gallery)
- âœ… UI Ù…ØªÙƒØ§Ù…Ù„
- âœ… Ø¯Ø¹Ù… Dark Mode

---

## â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: **6 Ø£ÙŠØ§Ù…**

---

**Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©**: Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1 (Backend Database) ğŸš€
